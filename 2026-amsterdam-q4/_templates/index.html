{% extends "_base.html" %}

{% block content %}

<section id="about" class="about-section section">

  <div class="container">
    <div class="event-countdown text-center mb-3">
    {% if event_state != 'after' %}
      <h4 class="countdown-intro mb-2 text-center mb-3">Event Starts In:</h4>
      <div id="countdown-box" class="countdown-box"></div>
    {% else %}
      <h4 class="countdown-intro mb-2 text-center mb-3">Event finished</h4>
    {% endif %}
    </div>
  </div>
  <script>
    /* ======= Countdown ========= */
    // set the date we're counting down to
    var target_date = new Date("{{ start_time }}").getTime();
     
    // variables for time units
    var days, hours, minutes, seconds;
     
    // get tag element
    var countdown =  document.getElementById("countdown-box");
    var days_span = document.createElement("SPAN");
    days_span.className = 'days';
    countdown.appendChild(days_span);
    var hours_span = document.createElement("SPAN");
    hours_span.className = 'hours';
    countdown.appendChild(hours_span);
    var minutes_span = document.createElement("SPAN");
    minutes_span.className = 'minutes';
    countdown.appendChild(minutes_span);
    var secs_span = document.createElement("SPAN");
    secs_span.className = 'secs';
    countdown.appendChild(secs_span);
     
    // update the tag with id "countdown" every 1 second
    setInterval(function () {
     
        // find the amount of "seconds" between now and target
        var current_date = new Date().getTime();
        var seconds_left = (target_date - current_date) / 1000;
     
        // do some time calculations
        days = parseInt(seconds_left / 86400);
        seconds_left = seconds_left % 86400;
         
        hours = parseInt(seconds_left / 3600);
        seconds_left = seconds_left % 3600;
         
        minutes = parseInt(seconds_left / 60);
        seconds = parseInt(seconds_left % 60);
         
        // format countdown string + set tag value.
        days_span.innerHTML = '<span class="number">' + days + '</span>' + '<span class="unit">Days</span>';
        hours_span.innerHTML = '<span class="number">' + hours + '</span>' + '<span class="unit">Hrs</span>';
        minutes_span.innerHTML = '<span class="number">' + minutes + '</span>' + '<span class="unit">Mins</span>';
        secs_span.innerHTML = '<span class="number">' + seconds + '</span>' + '<span class="unit">Secs</span>'; 
     
    }, 1000);
    </script>
</section>

<section id="tickets" class="tickets-section section">
  <div class="container">
    <h3 class="section-heading text-center mb-3">Tickets</h3>

    {% if event_state != 'after' %}
    <div class="row pricing mb-5 mt-10">
      <div class="col-12 text-center">
        {% include 'tickets.html' %} 
      </div>
    </div>
    {% endif %}

  </div>
</section>

{% if event_state == 'before' %}
<section id="schedule" class="schedule-section section theme-bg-light">
  <div class="container">
    <h2 class="section-heading text-center mb-5">Schedule</h2>
    <h4 class="section-heading text-center mb-5">Coming soon</h4>
  </div>
</section>
{% else %}
<style>
  /* Track navigation */
  .track-nav {
    padding: 0.75rem 0;
    margin-bottom: 1.5rem;
  }
  .track-nav-inner {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
  }
  .track-nav-links {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    justify-content: center;
  }
  .track-nav-links a {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: #098dcf;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    font-weight: 600;
    font-size: 0.9rem;
    transition: background 0.2s;
  }
  .track-nav-links a:hover {
    background: #0779b3;
    color: white;
  }
  .view-toggle-link {
    color: #098dcf;
    text-decoration: none;
    font-size: 0.9rem;
    cursor: pointer;
    padding: 0.5rem 0.75rem;
    border: 1px solid #098dcf;
    border-radius: 4px;
    transition: all 0.2s;
  }
  .view-toggle-link:hover {
    background: #098dcf;
    color: white;
  }
  .view-toggle-link.active {
    background: #098dcf;
    color: white;
  }
  /* Table view */
  .schedule-table-view { display: none; }
  .schedule-table-view.active { display: block; }
  .schedule-timeline-view { display: block; }
  .schedule-timeline-view.hidden { display: none; }
  .schedule-grid-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    margin-top: 1rem;
    table-layout: fixed;
  }
  .schedule-grid-table th {
    background: linear-gradient(135deg, #098dcf 0%, #0779b3 100%);
    color: white;
    padding: 0.75rem 1rem;
    text-align: left;
    font-weight: 600;
    font-size: 0.95rem;
  }
  .schedule-grid-table th:first-child {
    width: 60px;
  }
  .schedule-grid-table td {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #e5ecf4;
    vertical-align: top;
  }
  .schedule-grid-table td.merged-cell {
    text-align: center;
    font-weight: 500;
    color: #555;
    background: #f8fbfd;
  }
  .schedule-grid-table .time-cell {
    color: #098dcf;
    font-weight: 600;
    white-space: nowrap;
  }
  .schedule-grid-table .talk-cell a {
    color: #222;
    text-decoration: none;
    font-weight: 500;
  }
  .schedule-grid-table .talk-cell a:hover {
    color: #098dcf;
  }
  .schedule-grid-table .speaker-info {
    color: #444;
    font-size: 0.85rem;
    margin-top: 0.25rem;
  }
  .schedule-grid-table .speaker-info .affiliation {
    color: #666;
  }
  .schedule-meta {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
    font-size: 1.1rem;
    color: #333;
  }
  .schedule-meta-item {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.4rem 0.8rem;
    background: white;
    border-radius: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }
  .schedule-meta-divider {
    color: #ccc;
    font-weight: 300;
  }
  /* Track section header */
  .track-section-header {
    background: linear-gradient(135deg, #098dcf 0%, #0779b3 100%);
    color: white;
    padding: 1rem 1.5rem;
    margin: 2rem 0 0 0;
    border-radius: 4px 4px 0 0;
    font-size: 1.25rem;
    font-weight: 700;
  }
  .track-section-header:first-of-type {
    margin-top: 0;
  }

</style>

<section id="schedule" class="schedule-section section theme-bg-light">
  <div class="container">
    <h2 class="section-heading text-center mb-4">Schedule</h2>

    <!-- Schedule meta info -->
    <div class="schedule-meta">
      <span class="schedule-meta-item">{{ date_string }}</span>
      <span class="schedule-meta-divider">•</span>
      <span class="schedule-meta-item">{{ tracks|length }} parallel tracks</span>
    </div>

{% for day in range(days) %}
    <h4 class="section-heading text-center mb-5">Day {{ day + 1 }}</h4>

    <!-- Track navigation -->
    <div class="track-nav">
      <div class="track-nav-inner">
        <div class="track-nav-links" id="track-links-{{ day }}">
{% for track in tracks[(tracks|length)//days*(day):(tracks|length)//days*(day+1)] %}
          <a href="#track-{{ day }}-{{ loop.index }}">{{ rooms[loop.index0] }}</a>
{% endfor %}
        </div>
        <span class="view-toggle-link" id="view-toggle-{{ day }}" onclick="toggleView({{ day }})">view as table</span>
      </div>
    </div>

    <!-- Timeline View (default) -->
    <div id="timeline-view-{{ day }}" class="schedule-timeline-view">
{% for track in tracks[(tracks|length)//days*(day):(tracks|length)//days*(day+1)] %}
      <div class="track-section-header" id="track-{{ day }}-{{ loop.index }}">{{ rooms[loop.index0] }} &bull; Track {{ track }}</div>
      <div class="schedule-tab-content">
        <div class="tab-pane active">
{% for talk in talks_by_tracks[track] %}
          <div class="item item-talk">
            <div class="meta">
              <h4 class="time mb-3">{{ talk.start_time.strftime('%H:%M') }}</h4>
              <div class="profile">
                <a href="#modal-speaker-{{ talk.id }}" data-bs-toggle="modal" data-bs-target="#modal-speaker-{{ talk.id }}"><img class="profile-image rounded-circle mb-2" src="{{ talk.photo_url }}" alt=""></a>
                <div class="name"><a class="theme-link" href="#modal-speaker-{{ talk.id }}" data-bs-toggle="modal" data-bs-target="#modal-speaker-{{ talk.id }}">{{ talk.name }}</a></div>
              </div>
            </div>
            <div class="content">
              <h3 class="title mb-3">
                <a class="theme-link" href="#modal-speaker-{{ talk.id }}" data-bs-toggle="modal" data-bs-target="#modal-speaker-{{ talk.id }}">{{ talk.title }}</a>
              </h3>
              <div class="location mb-3">{{ talk.comment }}{{ talk.organization }}</div>
              <div class="desc">{{ talk.abstract_s }}<br /><br /></div>
            </div>
          </div>
{% endfor %}
        </div>
      </div>
{% endfor %}
    </div>

    <!-- Table View -->
    <div id="table-view-{{ day }}" class="schedule-table-view">
      <table class="schedule-grid-table">
        <thead>
          <tr>
            <th>Time</th>
{% for track in tracks[(tracks|length)//days*(day):(tracks|length)//days*(day+1)] %}
            <th style="width: calc((100% - 60px) / {{ (tracks|length) // days }})">{{ rooms[loop.index0] }}</th>
{% endfor %}
          </tr>
        </thead>
        <tbody>
{% set all_times = [] %}
{% for track in tracks[(tracks|length)//days*(day):(tracks|length)//days*(day+1)] %}
{% for talk in talks_by_tracks[track] %}
{% if talk.start_time.strftime('%H:%M') not in all_times %}
{% set _ = all_times.append(talk.start_time.strftime('%H:%M')) %}
{% endif %}
{% endfor %}
{% endfor %}
{% for time in all_times|sort %}
{% set ns = namespace(talks_at_time=[], titles=[]) %}
{% for track in tracks[(tracks|length)//days*(day):(tracks|length)//days*(day+1)] %}
{% for talk in talks_by_tracks[track] if talk.start_time.strftime('%H:%M') == time %}
{% set _ = ns.talks_at_time.append(talk) %}
{% set _ = ns.titles.append(talk.title) %}
{% endfor %}
{% if ns.talks_at_time|length < loop.index %}
{% set _ = ns.talks_at_time.append(none) %}
{% set _ = ns.titles.append('') %}
{% endif %}
{% endfor %}
{% if ns.titles|unique|list|length == 1 and ns.titles[0] != '' %}
          <tr>
            <td class="time-cell">{{ time }}</td>
            <td class="talk-cell merged-cell" colspan="{{ (tracks|length) // days }}">{{ ns.titles[0] }}</td>
          </tr>
{% else %}
          <tr>
            <td class="time-cell">{{ time }}</td>
{% for track in tracks[(tracks|length)//days*(day):(tracks|length)//days*(day+1)] %}
            <td class="talk-cell">
{% for talk in talks_by_tracks[track] if talk.start_time.strftime('%H:%M') == time %}
              <a href="#modal-speaker-{{ talk.id }}" data-bs-toggle="modal" data-bs-target="#modal-speaker-{{ talk.id }}">{{ talk.title }}</a>
              <div class="speaker-info">{{ talk.name }}{% if talk.organization %} <span class="affiliation">• {{ talk.organization }}</span>{% endif %}</div>
{% endfor %}
            </td>
{% endfor %}
          </tr>
{% endif %}
{% endfor %}
        </tbody>
      </table>
    </div>

{% endfor %}

    <script>
    function toggleView(day) {
      const timelineView = document.getElementById('timeline-view-' + day);
      const tableView = document.getElementById('table-view-' + day);
      const toggleBtn = document.getElementById('view-toggle-' + day);
      const trackLinks = document.getElementById('track-links-' + day);

      if (tableView.classList.contains('active')) {
        tableView.classList.remove('active');
        timelineView.classList.remove('hidden');
        toggleBtn.textContent = 'view as table';
        toggleBtn.classList.remove('active');
        trackLinks.style.display = 'flex';
      } else {
        tableView.classList.add('active');
        timelineView.classList.add('hidden');
        toggleBtn.textContent = 'view as timeline';
        toggleBtn.classList.add('active');
        trackLinks.style.display = 'none';
      }
    }
    </script>

    <div class="schedule-cta text-center mx-auto mt-4"><a href="#tickets" class="btn btn-secondary btn-lg d-block d-md-inline-block">Buy Tickets</a></div>
  </div>
</section>
{% endif %}


<section id="speakers" class="speakers-section section">
  <div class="container">
    <h3 class="section-heading text-center mb-3">Speakers</h3>
    <div class="row">

      {% for talk in (talks + keynotes)|sort(attribute='name')|dedupe %}

      <div class="col-6 col-lg-3 mb-4">
        <div class="card rounded">
          <a href="#modal-speaker-{{ talk.id }}" data-bs-toggle="modal" data-bs-target="#modal-speaker-{{ talk.id }}"><img src="{{ talk.photo_url }}" class="card-img-top rounded-0" alt=""></a>
          <div class="card-body">
            <h5 class="card-title mb-2">{{ talk.name }}</h5>
            <div class="card-text mb-3">
              <div class="meta">{{ talk.organization }}</div>
            </div><!--//card-text-->
            <a href="./{{ talk.short_url }}">Read more &rarr;</a>
          </div><!--//card-->
          <div class="card-footer text-muted">
            <ul class="social-list list-inline mb-0">
              {% if talk.twitter %}<li class="list-inline-item"><a  href="https://twitter.com/{{ talk.twitter }}"><i class="fab fa-twitter fa-fw"></i></a></li>{% endif %}
              {% if talk.linkedin %}<li class="list-inline-item"><a  href="{{ talk.linkedin }}"><i class="fab fa-linkedin-in fa-fw"></i></a></li>{% endif %}
              {% if talk.twitter2 %}<li class="list-inline-item"><a  href="https://twitter.com/{{ talk.twitter2 }}"><i class="fab fa-twitter fa-fw"></i></a></li>{% endif %}
              {% if talk.linkedin2 %}<li class="list-inline-item"><a  href="{{ talk.linkedin2 }}"><i class="fab fa-linkedin-in fa-fw"></i></a></li>{% endif %}
            </ul><!--//social-list-->
          </div>
        </div><!--//card-->
      </div><!--//col-->

      {% endfor %}

      {% if event_state == 'before' %}

      <div class="col-6 col-lg-3 mb-4">
        <div class="card">
          <div class="card-body">
            <h4>More coming soon</h4>
          </div><!--//card-->
        </div><!--//card-->
      </div><!--//col-->

      {% endif %}

    </div><!--//row-->
    <div class="speakers-cta text-center py-3"><a class="btn btn-primary btn-lg" href="#tickets">Get Tickets</a></div>
  </div><!--//container-->

</section><!--//speakers-section-->

{% include 'venue.html' %}

<section id="sponsors" class="sponsors-section section">
  <div class="container">
    <h3 class="section-heading text-center mb-3">Sponsors &amp; Partners</h3>
    <div class="section-intro text-center single-col-max mx-auto mb-5">Want to become a sponsor? Get in touch!</div>
    <div class="row logos justify-content-center">
      {% for sponsor in sponsors %}
      <div class="logo-item col-6 col-md-4 col-lg-2"><a href="{{sponsor.url}}" target="_blank"><img src="./assets/images/sponsors/{{ sponsor.logo }}" alt=""></a></div>
      {% endfor %}
    </div><!--//row-->
    <div class="sponsors-cta text-center pt-5"><a class="btn-primary btn btn-lg" href="mailto:hello@sreday.com">Become A Sponsor</a></div>
  </div><!--//container-->
</section><!--//sponsors-section-->


{% for talk in talks + keynotes %}
<!-- Modal Speaker {{ talk.id }} -->
<div class="modal modal-speaker modal-speaker-{{ talk.id }}" id="modal-speaker-{{ talk.id }}" tabindex="-1" role="dialog" aria-labelledby="speaker-{{ talk.id }}-ModalLabel" aria-hidden="true">
  <div class="modal-dialog">
      <div class="modal-content">
          <div class="modal-header">
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 id="speaker-{{ talk.id }}-ModalLabel" class="modal-title sr-only"
>{{ talk.name }}</h4>
          </div>
          <div class="modal-body p-0">
              <div class="theme-bg-light p-5">
                  <div class="row">
                      <div class="col-12 col-md-auto text-center">
                          <img class="profile-image mb-3 mb-md-0 me-md-4 rounded-circle mx-auto" src="{{ talk.photo_url }}" alt="" />
                      </div>

                      <div class="col text-center text-md-start mx-auto">
                          <h2 class="name mb-2">{{ talk.name }}</h2>
                          <div class="meta mb-2">{{ talk.organization }}</div>
                          <ul class="social-list list-inline mb-0">
                            {% if talk.twitter %}<li class="list-inline-item"><a  href="https://twitter.com/{{ talk.twitter }}"><i class="fab fa-twitter fa-fw"></i></a></li>{% endif %}
                            {% if talk.linkedin %}<li class="list-inline-item"><a  href="{{ talk.linkedin }}"><i class="fab fa-linkedin-in fa-fw"></i></a></li>{% endif %}
                            {% if talk.twitter2 %}<li class="list-inline-item"><a  href="https://twitter.com/{{ talk.twitter2 }}"><i class="fab fa-twitter fa-fw"></i></a></li>{% endif %}
                            {% if talk.linkedin2 %}<li class="list-inline-item"><a  href="{{ talk.linkedin2 }}"><i class="fab fa-linkedin-in fa-fw"></i></a></li>{% endif %}
                          </ul><!--//social-list-->
                      </div><!--//col-->
                  </div><!--//row-->
              </div>
              <div class="desc p-2 p-lg-3">
                <p>{{ talk.abstract | markdown }}</p>
              </div>
              <div class="desc p-2 p-lg-3">
                <p>{{ talk.description | markdown }}</p>
              </div>
              <div class="desc p-2 p-lg-3">
                <p>{{ talk.bio | markdown }}</p>
              </div>
          </div><!--//modal-body-->
      </div><!--//modal-content-->
  </div><!--//modal-dialog-->
</div><!--//modal-->
{% endfor %}

{% endblock %}
