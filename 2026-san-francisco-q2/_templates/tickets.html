<div class="ratio ratio-16x9">
  <iframe
    class=""
    data-src="https://lu.ma/embed/event/{{ luma_evt }}/simple"
    width="800"
    height="690"
    frameborder="0"
    style="border: 1px solid #bfcbda88; border-radius: 4px;"
    allowfullscreen=""
    aria-hidden="false"
    tabindex="0"
  ></iframe>
</div>

<a
  href="https://lu.ma/event/{{ luma_evt }}"
  class="luma-checkout--button"
  data-luma-action="checkout"
  data-luma-event-id="{{ luma_evt }}"
>
  Register on luma
</a>

<script id="luma-checkout" src="https://embed.lu.ma/checkout-button.js"></script>
<script>
  (function() {
    var params = window.location.search;
    
    // 1. Handle the Iframe (Prevent double-load)
    var iframe = document.querySelector('iframe[data-src*="lu.ma/embed"]');
    if (iframe) {
      var src = iframe.getAttribute('data-src');
      var separator = src.indexOf('?') > -1 ? '&' : '?';
      // Set the real 'src' now, including params
      iframe.setAttribute('src', src + (params ? separator + params.substring(1) : ''));
    }

    // 2. Handle the Button
    if (params) {
      var btn = document.querySelector('.luma-checkout--button');
      if (btn) {
        var href = btn.getAttribute('href');
        var separator = href.indexOf('?') > -1 ? '&' : '?';
        btn.setAttribute('href', href + separator + params.substring(1));
      }
    }
  })();
</script>
